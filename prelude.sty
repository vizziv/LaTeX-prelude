\NeedsTeXFormat{LaTeX2e}[1994/06/01]
\ProvidesPackage{prelude}[2017/01/06 Ziv's Prelude]

% Use the acm option for compatibility with the acmart class.
\newif\if@acm\@acmfalse
\newif\if@acmold\@acmoldfalse
\newif\if@ieee\@ieeefalse
\newif\if@libertine\@libertinefalse
\newif\if@charter\@charterfalse
\newif\if@nofont\@nofontfalse
\newif\if@fancyhdr\@fancyhdrfalse
\DeclareOption{acm}{\@acmtrue}
\DeclareOption{acmold}{\@acmoldtrue}
\DeclareOption{ieee}{\@ieeetrue}
\DeclareOption{libertine}{\@libertinetrue}
\DeclareOption{charter}{\@chartertrue}
\DeclareOption{nofont}{\@nofonttrue}
\DeclareOption{fancyhdr}{\@fancyhdrtrue}
\DeclareOption{nofancyhdr}{\@fancyhdrfalse}

% Automatically invoke the acm option if the class is loaded.
\@ifclassloaded{acmart}{\ExecuteOptions{acm, nofont}}{%
  \@ifclassloaded{sig-alternate}{\ExecuteOptions{acmold, nofont}}{%
    \@ifclassloaded{ieeeconf}{\ExecuteOptions{ieee, nofont}}{%
      \ExecuteOptions{libertine, fancyhdr}}}
  % Need this to not mess up a nested conditional later.
  \newif\if@ACM@authorversion}

\ProcessOptions\relax


% Packages.

\if@acmold
  \let\proof\undefined
  \let\endproof\undefined
\fi

\if@ieee
  \let\proof\undefined
  \let\endproof\undefined
  \let\labelindent\undefined
  \let\NAT@parse\undefined
\fi


% AMS packages often need to be first for compatibility.
\RequirePackage{amsmath, amsthm}

\newcommand{\@titlestyle}{\sffamily\bfseries}
\newcommand{\@titlestyleoptions}{sf, bf}
\newcommand{\@headerstyle}{\sffamily}
\def\@definefonts{}
\if@libertine
  \def\@definefonts{%
    \RequirePackage[tt=false]{libertine}
    \RequirePackage[varqu]{zi4}
    \RequirePackage[libertine]{newtxmath}}
\fi
\if@charter
  \def\@definefonts{%
    \RequirePackage[charter, cal=cmcal]{mathdesign}
    \RequirePackage[varqu]{zi4}
    \RequirePackage{berasans}}
  \renewcommand{\@titlestyle}{\bfseries}
  \renewcommand{\@titlestyleoptions}{bf}
  \renewcommand{\@headerstyle}{}
\fi
\if@nofont
  \def\@definefonts{}
\fi
\@definefonts

\if@fancyhdr
  \RequirePackage[\@titlestyleoptions]{titlesec}
  \RequirePackage[labelfont={bf}, font={small}]{caption}
  \RequirePackage{fancyhdr, titling}
  \titlespacing*{\chapter}{0pt}{-50pt}{30pt}
  \titleformat{\chapter}{%
    \huge\@titlestyle}{%
    \thechapter}{%
    1em}{%
    \hyphenpenalty=10000\raggedright%
    \huge\@titlestyle}[%
    \rule{\textwidth}{\heavyrulewidth}]
\fi

\if@acm
  \AtBeginDocument{\setcitestyle{numbers,sort&compress,square}}
\else
  \RequirePackage[numbers, sort&compress, square]{natbib}
  \RequirePackage[hidelinks]{hyperref}
\fi

\RequirePackage[inline, shortlabels]{enumitem}
\RequirePackage[section]{algorithm}
\RequirePackage[shortcuts]{extdash}
\RequirePackage{bm, booktabs, dsfont, etoolbox, framed, mathtools, microtype,
  ragged2e, tabularx, tikz, thmtools, varwidth, xifthen, xparse, xstring}

% Wants to be loaded after any package that deals with labels or references.
\RequirePackage[capitalize]{cleveref}


% Emptiness checking.

\newcommand{\ifempty}[3]{\ifthenelse{\isempty{#1}}{#2}{#3}}


% I'm done dealing with \@....

\frenchspacing


% Remove newlines.

\newcommand{\nonewlines}[1]{%
  \let\@oldnewline=\\
  \let\\=\ignorespaces
  #1%
  \let\\=\@oldnewline}


% Format title, header, and footer.

\if@fancyhdr
  \@ifclassloaded{book}{%
    \newcommand{\@titlesize}{\huge}}{%
    \newcommand{\@titlesize}{\LARGE}}
  \def\@shorttitle{}
  \let\@oldtitle\title
  \renewcommand{\title}[2][]{%
    \def\@shorttitle{#1}
    \@oldtitle{#2}}
  \def\@shortauthor{}
  \let\@oldauthor\author
  \renewcommand{\author}[2][]{%
    \def\@shortauthor{#1}
    \@oldauthor{#2}}
  \pretitle{%
    \vspace{-3.75\baselineskip}
    \begin{center}
      \hyphenpenalty=10000%
      \@titlesize\@titlestyle}
  \let\@oldmaketitle\maketitle
  \renewcommand{\maketitle}{%
    \@oldmaketitle
    \thispagestyle{fancy}
    \vspace{-2\baselineskip}
    % Usual "if empty" hack. Could maybe use \ifempty.
    \if\relax\@shorttitle\relax
      \def\@titlenonewlines{\nonewlines{\@title}}
      \let\@thetitle\@titlenonewlines
    \else
      \let\@thetitle\@shorttitle
    \fi
    \if\relax\@shortauthor\relax
      \def\@authornonewlines{\nonewlines{\@author}}
      \let\@theauthor\@authornonewlines
    \else
      \let\@theauthor\@shortauthor
    \fi}
  \pagestyle{fancy}
  \fancyhf{}
  \@ifclassloaded{book}{%
    \renewcommand{\chaptermark}[1]{\markboth{#1}{}}
    \renewcommand{\sectionmark}[1]{%
      \markright{\arabic{chapter}.\arabic{section} #1}}
    \let\@oldtableofcontents\tableofcontents
    \renewcommand{\tableofcontents}{\@oldtableofcontents\chaptermark{Contents}}
    \fancyhead[CE]{\@headerstyle\leftmark}
    \fancyhead[CO]{\@headerstyle\rightmark}
    \fancyhead[LE, RO]{\@headerstyle\thepage}
    \fancypagestyle{plain}{
      \fancyhf{}
      \fancyfoot[C]{\@headerstyle\thepage}
      \renewcommand{\headrulewidth}{0pt}}}{%
    \fancyhead[L]{\@headerstyle\@thetitle}
    \fancyhead[R]{\@headerstyle\@theauthor}
    \fancyfoot[C]{\@headerstyle\thepage}}
\fi

\if@acm
  \RenewDocumentCommand{\title}{om}{%
    \IfNoValueTF{#1}{%
      \gdef\shorttitle{\nonewlines{#2}}}{%
      \gdef\shorttitle{#1}}%
    \gdef\@title{#2}}
\fi

\if@acm
\else
  \newlength{\listtopsep}
  \setlength{\listtopsep}{\smallskipamount}
  \newlength{\listitemsep}
  \setlength{\listitemsep}{\smallskipamount}
  \setlist{parsep=\parskip, topsep=\listtopsep, itemsep=\listitemsep}
\fi

\newcommand{\nodate}{%
  \date{\vspace{-1.75\baselineskip}}
  \renewcommand{\thedate}{}}

\newcommand{\noauthor}{%
  \author{\thedate}
  \nodate
  \let\thedate\theauthor}

\date{\today}

\if@acm
  \newtoggle{noarticlenum}
  \if@ACM@authorversion
    \let\@oldsetcopyright\footnotetextcopyrightpermission
    \newlength{\authorversionskip}
    \setlength{\authorversionskip}{0in}
    \ifdefstring{\ACM@format}{acmsmall}{%
      \setlength{\authorversionskip}{0.39in}
      \toggletrue{noarticlenum}}{}
    \ifdefstring{\ACM@format}{acmlarge}{%
      \setlength{\authorversionskip}{0.525in}
      \toggletrue{noarticlenum}}{}
    \ifdefstring{\ACM@format}{sigconf}{%
      \setlength{\authorversionskip}{0.09in}}{}
    \renewcommand{\footnotetextcopyrightpermission}[1]{%
        \@oldsetcopyright{#1\vspace{\authorversionskip}}}
  \fi
\fi

% References.

% Prevents break between previous text and citation number,
% unless the citation command is given an optional argument.
\let\@oldcitet\citet
\renewcommand{\citet}[2][]{%
  % \NAT@spacechar goes between the author name and citation number.
  {\IfSubStr{#2}{,}{}{\ifempty{#1}{\def\NAT@spacechar{~}}{}}%
    \@oldcitet[#1]{#2}}}
\let\@oldcitep\citep
\renewcommand{\citep}[2][]{%
  % This assumes we always want a regular space before lone citation numbers.
  % To supress the space, give \empty as the optional argument.
  {\IfSubStr{#2}{,}{}{\ifempty{#1}{\unskip~}{}}%
    \@oldcitep[#1]{#2}}}

% Same for capitalized versions.
\let\@oldCitet\Citet
\renewcommand{\Citet}[2][]{%
  {\IfSubStr{#2}{,}{}{\ifempty{#1}{\def\NAT@spacechar{~}}{}}%
    \@oldCitet[#1]{#2}}}
\let\@oldCitep\Citep
\renewcommand{\Citep}[2][]{%
  {\IfSubStr{#2}{,}{}{\ifempty{#1}{\unskip~}{}}%
    \@oldCitep[#1]{#2}}}

% Always use same font style for citations... by uncommenting the following.
% \let\@oldishcitet\citet
% \renewcommand{\citet}[2][]{{\normalfont\@oldishcitet[#1]{#2}}}
% \let\@oldishcitep\citep
% \renewcommand{\citep}[2][]{{\normalfont\@oldishcitep[#1]{#2}}}

% Configure cleveref.
\newcommand{\crefrangeconjunction}{--}
\crefname{equation}{}{}
\Crefname{equation}{Equation}{Equations}
\crefname{enumi}{}{}
\Crefname{enumi}{Item}{Items}

% IEEE abbreviates "Figure" to "Fig."
\if@ieee
  \crefname{figure}{Fig.}{Fig.}
  % But use the whole word when starting a sentence.
  \Crefname{figure}{Figure}{Figure}
\fi

% We usually want the same names for \cref and \Cref.
\newcommand{\cCrefname}[3]{\crefname{#1}{#2}{#3}\Crefname{#1}{#2}{#3}}

% Add some backwards compatibility with fancyref.
\newcommand{\fref}{\cref}
\newcommand{\Fref}{\Cref}

% Allow spaces between labels in \cref and \Cref.
% (This is an egreg stackexchange answer.)
\ExplSyntaxOn
\cs_set_eq:Nc \bers_cref:nn { @cref }
\cs_generate_variant:Nn \bers_cref:nn { nx }
\cs_set_protected:cpn { @cref } #1 #2
 {
  \seq_set_split:Nnn \l_bers_cref_seq { , } { #2 }
  \bers_cref:nx { #1 } { \seq_use:Nn \l_bers_cref_seq { , } }
 }
\seq_new:N \l_bers_cref_seq
\ExplSyntaxOff


% Math typesetting.

% Prevent line breaks in inline math.
\relpenalty=10000
\binoppenalty=10000

% By default, use normal text in math, even with styled surrounding text.
\let\textenv\text
\renewcommand{\text}{\textnormal}

% Use doublestroke for blackboard bold fonts.
\def\mathbb{\mathds}

% Correct spacing of italic text before inline math.
\mathtoolsset{mathic}

% Correct spacing of italic text after inline math.
\newtoggle{noendsub}
\toggletrue{noendsub}
\newcommand{\esub}{\togglefalse{noendsub}}
\let\@oldmath\(% \)
\renewcommand{\(}{% \)
  \@oldmath}
\let\@oldendmath\)
\renewcommand{\)}{%
  % Couldn't get this to work with \itdefault, so manually expanded.
  \ifdefstring{\f@shape}{it}{%
    \iftoggle{noendsub}{\sb{}}{}\kern-\scriptspace}{}\@oldendmath}
\catcode`\$=13 % active
\def$#1${\(#1\)}

% Vertical smash for reducing height of display fractions and similar.
\newcommand{\vsmashbelow}[1]{\raisebox{0em}[\height][0em]{$\displaystyle #1$}}

\newcommand{\@raisemathhelper}[3]{\raisebox{#1}{$#2#3$}}
\newcommand{\raisemath}[1]{\mathpalette{\@raisemathhelper{#1}}}

% Use less space for align and alignat.
% This also changes equation numbering, but in a way that I usually like.
% It requires a trick for \qedhere to work correctly.
\newtoggle{alignqedhere}
\togglefalse{alignqedhere}
\newcommand{\@prealigned}{%
  % Need to use \global because \qedhere will be written inside the aligned,
  % but we want it to appear inside the equation* outside the aligned.
  % Using global scope is okay because equations don't nest.
  \begingroup
  \renewcommand{\qedhere}{%
    \global\toggletrue{alignqedhere}}}
\newcommand{\@postaligned}{%
  \endgroup
  \iftoggle{alignqedhere}{\qedhere}{}
  \global\togglefalse{alignqedhere}}
\renewenvironment{align*}{%
  \begin{equation*}\@prealigned\begin{aligned}[b]}{%
  \end{aligned}\@postaligned\end{equation*}\ignorespacesafterend}
\renewenvironment{align}{%
  \begin{equation}\@prealigned\begin{aligned}[b]}{%
  \end{aligned}\@postaligned\end{equation}\ignorespacesafterend}
\renewenvironment{alignat*}[1]{%
  \begin{equation*}\@prealigned\begin{alignedat}{#1}}{%
  \end{alignedat}\@postaligned\end{equation*}\ignorespacesafterend}
\renewenvironment{alignat}[1]{%
  \begin{equation}\@prealigned\begin{alignedat}[b]{#1}}{%
  \end{alignedat}\@postaligned\end{equation}\ignorespacesafterend}

% Dots inside parentheses.
\let\@olddots\dots
\renewcommand{\dots}{\@olddots\ifmmode\mkern0mu\fi}
\let\@olddotsc\dotsc
\renewcommand{\dotsc}{\@olddotsc\ifmmode\mkern0mu\fi}
\let\@olddotsb\dotsb
\renewcommand{\dotsb}{\@olddotsb\ifmmode\mkern0mu\fi}
\let\@olddotsm\dotsm
\renewcommand{\dotsm}{\@olddotsm\ifmmode\mkern0mu\fi}
\let\@olddotsi\dotsi
\renewcommand{\dotsi}{\@olddotsi\ifmmode\mkern0mu\fi}
\let\@olddotso\dotso
\renewcommand{\dotso}{\@olddotso\ifmmode\mkern0mu\fi}


% TikZ

\usetikzlibrary{calc}

% Make the $ hack above compatible with TikZ.
\let\@oldtikzpicture\tikzpicture
\def\tikzpicture{%
  \catcode`\$=3 % math shift
  \@oldtikzpicture}


% Make rules in algorithm environment match those in tables.

\renewcommand{\fs@ruled}{%
  \def\@fs@cfont{\bfseries}\let\@fs@capt\floatc@ruled
  \def\@fs@pre{%
    \vspace{\abovetopsep}%
    \hrule height\heavyrulewidth \kern2pt%
    \vspace{\belowrulesep}}%
  \def\@fs@post{%
    \vspace{\aboverulesep}%
    \kern2pt\hrule height\heavyrulewidth \relax%
    \vspace{\belowbottomsep}}%
  \def\@fs@mid{%
    \vspace{\aboverulesep}%
    \kern2pt\hrule height\lightrulewidth \kern2pt%
    \vspace{\belowrulesep}}%
  \let\@fs@iftopcapt\iftrue}


% Macros for defining further macros.

\newcommand{\subopt}[2]{\ifempty{#2}{#1}{#1_{#2}}}
\newcommand{\supopt}[2]{\ifempty{#2}{#1}{#1^{#2}}}
\newcommand{\appopt}[2]{\ifempty{#2}{#1}{#1(#2)}}
\newcommand{\sqappopt}[2]{\ifempty{#2}{#1}{#1[#2]}}
\newcommand{\curlappopt}[2]{\ifempty{#2}{#1}{#1\{#2\}}}
\newcommand{\angappopt}[2]{\ifempty{#2}{#1}{#1 \langle #2 \rangle}}
\newcommand{\midopt}[2]{\ifempty{#2}{#1}{#1 \mid #2}}


% Theorems.

\if@acm
  \theoremstyle{acmplain}
\else
  \theoremstyle{plain}
\fi
\if@ieee
  \newtheorem{theorem}{Theorem}
\else
  \newtheorem{theorem}{Theorem}[section]
\fi
\cCrefname{theorem}{Theorem}{Theorems}
\newtheorem{lemma}[theorem]{Lemma}
\cCrefname{lemma}{Lemma}{Lemmas}
\newtheorem{proposition}[theorem]{Proposition}
\cCrefname{proposition}{Proposition}{Propositions}
\newtheorem{corollary}[theorem]{Corollary}
\cCrefname{corollary}{Corollary}{Corollaries}
\newtheorem{conjecture}[theorem]{Conjecture}
\cCrefname{conjecture}{Conjecture}{Conjectures}
\newtheorem{claim}[theorem]{Claim}
\cCrefname{claim}{Claim}{Claims}
\thmt@original@newtheorem*{generictheorem*}{\@theoremname}

\if@acm
  \theoremstyle{acmdefinition}
\else
  \theoremstyle{definition}
\fi
\newtheorem{definition}[theorem]{Definition}
\cCrefname{definition}{Definition}{Definitions}
\newtheorem{example}[theorem]{Example}
\cCrefname{example}{Example}{Examples}
\newtheorem{assumption}[theorem]{Assumption}
\cCrefname{assumption}{Assumption}{Assumptions}
\newtheorem{exercise}{Exercise}[section]
\cCrefname{exercise}{Exercise}{Exercises}
\newtheorem{observation}[theorem]{Observation}
\cCrefname{observation}{Observation}{Observations}
\thmt@original@newtheorem*{genericobservation*}{\@theoremname}
\if@acm
\else
  \theoremstyle{remark}
\fi
\newtheorem*{remark*}{Remark}

\if@acm
  \newtheoremstyle{acmcase}
    {.5\baselineskip\@plus.2\baselineskip
      \@minus.2\baselineskip}
    {.5\baselineskip\@plus.2\baselineskip
      \@minus.2\baselineskip}
    {\@acmdefinitionbodyfont}
    {\@acmdefinitionindent}
    {\@acmdefinitionheadfont}
    {.}
    {.5em}
    {\thmname{#1}\thmnumber{ #2}\thmnote{{\@acmdefinitionnotefont: #3}}}
  \theoremstyle{acmcase}
  \newtheorem{case}{Case}
\else
  \theoremstyle{remark}
  \newtheorem{case}{Case}
  % Use a colon instead of parentheses for names of cases.
  \newcommand{\@thmheadcase}[3]{\thmname{#1}\thmnumber{ #2}\thmnote{: #3}}
  \let\@oldcase\case
  \def\case{\let\thmhead\@thmheadcase\@oldcase}
\fi
\cCrefname{case}{Case}{Cases}

\if@ieee
\else
  \numberwithin{equation}{section}
  \numberwithin{figure}{section}
  \numberwithin{table}{section}
\fi

% Resets case number every proof and restores ordinary QED symbol.
\let\@oldproof\proof
\let\@oldqed\qed
\def\proof{\startcases\renewcommand{\qed}{\@oldqed}\@oldproof}

% Named theorems and observations.
\newenvironment{namedtheorem*}[1]{%
  \newcommand{\@theoremname}{#1}\begin{generictheorem*}}{%
  \end{generictheorem*}\ignorespacesafterend}
\newenvironment{namedobservation*}[1]{%
  \newcommand{\@theoremname}{#1}\begin{genericobservation*}}{%
  \end{genericobservation*}\ignorespacesafterend}

% Solutions to exercises.

\newenvironment{solution}[1][]{%
  \begin{proof}[Solution\ifempty{#1}{}{ to \cref{#1}}]
  \noqed}{
  \end{proof}\ignorespacesafterend}


% Macros to actually use.

% Suppress the QED symbol from a proof.
\newcommand{\noqed}{\renewcommand{\qed}{}}

% Start a series of cases. Useful for cases outside proofs.
\newcommand{\startcases}{\setcounter{case}{0}}

% Even more quad!
\newcommand{\qqquad}{\hskip3em\relax}

% Suppress the copyright block when using ACM class and other cleaning up.
\if@acm
  \newcommand{\nocopyright}{\renewcommand{\footnotetextcopyrightpermission}[1]{}}
  \newcommand{\acmclean}{%
    \settopmatter{printfolios, printacmref=false}
    \nocopyright
    \authorsaddresses{}
    \ifdefstring{\ACM@format}{sigconf}{%
      \ifdefstring{\acmConference@name}{ACM Conference}{%
        \fancyhead[LE, RO]{}}{}}{}
    \ifdefstring{\ACM@format}{acmsmall}{%
      \toggletrue{noarticlenum}
      \fancyfoot{}
      \fancypagestyle{firstpagestyle}{\fancyhf{}}}{}
    \ifdefstring{\ACM@format}{acmlarge}{%
      \toggletrue{noarticlenum}
      \fancyfoot{}
      \fancypagestyle{firstpagestyle}{\fancyhf{}}}{}}
  % Either authorversion of \acmclean can set this toggle.
  \AtBeginDocument{%
    \iftoggle{noarticlenum}{%
      \acmArticleSeq{0}
      % Horrible hackiness to hide article number.
      \let\@oldhffont\@headfootfont
      \def\@headfootfont{%
        \renewcommand\@acmArticle[2]{##1}
        \@oldhffont}}{}}
\fi

% Column type that justifies text.
\newcolumntype{J}{>{\justifying\noindent\arraybackslash}X}

% Variation of \smallbreak and friends that does not encourage a break.
\newcommand{\smallgap}{%
  \par
  \ifdim\lastskip < \smallskipamount
    \removelastskip
    \smallskip
  \fi}
\newcommand{\medgap}{%
  \par
  \ifdim\lastskip < \medskipamount
    \removelastskip
    \medskip
  \fi}
\newcommand{\biggap}{%
  \par
  \ifdim\lastskip < \bigskipamount
    \removelastskip
    \bigskip
  \fi}
\newcommand{\vgap}[1]{%
  \par
  \ifdim\lastskip < #1
    \removelastskip
    \vspace{#1}
  \fi}

% Tables for inline text.
\newlength{\tabulateskip}
\setlength{\tabulateskip}{\medskipamount}
\newenvironment{tabulate}[1]{%
  \vgap{\tabulateskip}\centering\tabular{#1}}{%
  \endtabular\vgap{\tabulateskip}\noindent\ignorespacesafterend}
\newenvironment{tabulatex}[2]{%
  \vgap{\tabulateskip}\centering\tabularx{#1}{#2}}{%
  \endtabularx\vgap{\tabulateskip}\noindent\ignorespacesafterend}

\newcommand{\todonote}[1]{\fbox{\textbf{TODO:} #1}}
\newenvironment{todo}{%
  \begin{framed}\noindent\textbf{TODO:}}{%
  \end{framed}\ignorespacesafterend}
\if@acm
  \setlength\marginparwidth{0.62in}
  \setlength\marginparsep{0.06in}
\fi
\newcommand{\marginnote}[1]{\marginpar{\scriptsize #1}}


% Math macros.

\renewcommand{\epsilon}{\varepsilon}
\renewcommand{\phi}{\varphi}
\renewcommand{\emptyset}{\varnothing}
\newcommand{\hole}{\cdot}

\newcommand{\mc}{\mathcal}
\newcommand{\tl}{\tilde}

% More space on left because most math is italic.
\newcommand{\ol}[1]{%
  \mkern 2.4mu\overline{\mkern-2.4mu#1\mkern-0.8mu}\mkern 0.8mu}

\def\C{\mathbb{C}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\1}{\mathbb{1}}

\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator*{\argmax}{arg\,max}

\let\mvert\vert
\newcommand{\given}{\nonscript\;\mvert\nonscript\;\mathopen{}}
\newcommand{\@resizegiven}{%
  \renewcommand{\given}{\nonscript\;\delimsize\mvert\nonscript\;\mathopen{}}}
\renewcommand{\mid}{\given}
\undef\angle
\DeclarePairedDelimiterX\angle[1]\langle\rangle{\@resizegiven #1}
\undef\vert
\DeclarePairedDelimiterX\vert[1]\lvert\rvert{\@resizegiven #1}
\DeclarePairedDelimiterX\floor[1]\lfloor\rfloor{\@resizegiven #1}
\DeclarePairedDelimiterX\ceil[1]\lceil\rceil{\@resizegiven #1}
% "gp" for "group"
\DeclarePairedDelimiterX\gp[1](){\@resizegiven #1}
\DeclarePairedDelimiterX\sqgp[1][]{\@resizegiven #1}
\DeclarePairedDelimiterX\curlgp[1]\{\}{\@resizegiven #1}

\renewcommand{\d}{\mathrm{d}}
\newcommand{\dd}[2][]{\frac{\d #1}{\d #2}}
\newcommand{\pd}[2][]{\frac{\partial #1}{\partial #2}}

\newcommand{\ldelimP}{\{}
\newcommand{\rdelimP}{\}}
\newcommand{\ldelimE}{[}
\newcommand{\rdelimE}{]}
\newcommand{\ldelimVar}{(}
\newcommand{\rdelimVar}{)}
\undef\P
\DeclarePairedDelimiterXPP{\P}[1]{\mathbf{P}}{\ldelimP}{\rdelimP}{}{%
  \@resizegiven
  #1}
\DeclarePairedDelimiterXPP{\E}[1]{\mathbf{E}}{\ldelimE}{\rdelimE}{}{%
  \@resizegiven
  #1}
\DeclarePairedDelimiterXPP{\Var}[1]{\mathbf{Var}}{\ldelimVar}{\rdelimVar}{}{%
  \@resizegiven
  #1}


\endinput
